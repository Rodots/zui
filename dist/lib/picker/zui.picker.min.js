/*!
 * ZUI: 下拉选择器 - v1.10.0 - 2022-08-23
 * http://openzui.com
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2022 cnezsoft.com; Licensed MIT
 */
!function(e,t,i){"use strict";var o="zui.picker",r={},l={lang:null,remote:null,remoteConverter:null,remoteOnly:!1,onRemoteError:null,disableEmptySearch:!1,textKey:"text",valueKey:"value",keysKey:"keys",multi:"auto",formItem:"auto",list:null,allowSingleDeselect:null,autoSelectFirst:!1,maxSelectedCount:0,maxListCount:100,hideEmptyTextOption:!0,searchValueKey:!0,emptyResultHint:null,hideOnScroll:!0,inheritFormItemClasses:!1,emptySearchResultHint:null,accurateSearchHint:null,remoteErrorHint:null,deleteByBackspace:!0,disableScrollOnShow:!0,maxDropHeight:250,dropDirection:"auto",dropWidth:"100%",maxAutoDropWidth:450,minAutoDropWidth:100,multiValueSplitter:",",multiSelectActions:5,searchDelay:200,autoClearDrop:6e4,fixLabelFor:!0,hotkey:!0,onSelect:null,onDeselect:null,onBeforeChange:null,onChange:null,onReady:null,onNoResults:null,onShowingDrop:null,onHidingDrop:null,onShowedDrop:null,onHiddenDrop:null,valueMustInList:!0},n={zh_cn:{emptyResultHint:"没有可选项",emptySearchResultHint:"没有找到 “{0}”",accurateSearchHint:"请提供更多关键词缩小匹配范围",remoteErrorHint:"无法从服务器获取结果 - {0}",selectAll:"全选",deselectAll:"取消选择"},zh_tw:{emptyResultHint:"沒有可選項",emptySearchResultHint:"沒有找到 “{0}”",accurateSearchHint:"請提供更多關鍵詞縮小匹配範圍",remoteErrorHint:"無法從服務器獲取結果 - {0}",selectAll:"全選",deselectAll:"取消選擇"},en:{emptyResultHint:"No options",emptySearchResultHint:'Cannot found "{0}"',accurateSearchHint:"Suggest to provide more keywords",remoteErrorHint:"Unable to get result from server: {0}",selectAll:"Select all",deselectAll:"Deselect all"}},s=function(r,l){var a=this;a.name=o,a.$=e(r),a.id="pk_"+(a.$.attr("id")||e.zui.uuid()),l=a.options=e.extend({},s.DEFAULTS,this.$.data(),l),void 0!==l.hideOnWindowScroll&&(l.hideOnScroll=l.hideOnWindowScroll);var c=e.zui.clientLang?e.zui.clientLang():"en",p=l.lang||c;a.lang=e.zui.getLangData?e.zui.getLangData(o,p,n):n[p]||n[c];var d,u,h=l.formItem,v='.form-item,input[type="hidden"],select,input[type="text"]';if(d="self"===h?a.$:"auto"!==h&&h?a.$.find(h):a.$.is(v)?a.$:a.$.find(v).first(),!d.length)return console.error&&console.error("Cannot found form item for picker.");if(d.is('input[type="hidden"]'))u="hidden";else if(d.is("select"))u="select";else{if(!d.is('input[type="text"]'))return console.error&&console.error("Unknown form type for picker.");u="text"}l.inheritFormItemClasses&&m.addClass(d.attr("class")),a.formType=u,a.$formItem=d.removeClass("picker").hide(),a.selfFormItem=d.is(a.$);var f=l.multi;f&&"auto"!==f||(f="select"===u&&"multiple"===d.attr("multiple")),f=!!f,a.multi=f,f||(a.options.checkable=!1);var g=l.list;g?a.setList("function"==typeof g?g({search:a.search,limit:l.maxListCount}):g,!0):"select"===u?a.updateFromSelect():a.setList([],!0);var m;m=!a.selfFormItem&&a.$.hasClass("picker")?a.$:e('<div class="picker" />').insertAfter(a.$),m.addClass("picker").toggleClass("picker-multi",f).toggleClass("picker-single",!f);var y=m.children(".picker-selections");y.length?y.empty():y=e('<div class="picker-selections" />');var k=a.id+"-search",b=e('<input autocomplete="off" id="'+k+'" type="text" class="picker-search">').appendTo(y);if(!f){var S=e('<div class="picker-selection picker-selection-single"><span class="picker-selection-text"></span></div>');l.allowSingleDeselect&&S.append('<span class="picker-selection-remove"></span>'),S.appendTo(y),a.$singleSelection=S}m.toggleClass("picker-input-empty",!b.val().length).append(y),a.$container=m,a.$selections=y,a.$search=b,a.search="";var L=l.placeholder;if(void 0===L&&(L=d.attr("placeholder")),"string"==typeof L&&L.length&&y.append(e('<div class="picker-placeholder" />').text(L)),l.placeholder=L,l.fixLabelFor){var $=d.attr("id");$&&e('label[for="'+$+'"]').attr("for",k)}var x=void 0!==l.defaultValue?l.defaultValue:d.val();if(null===x&&(x=""),a.setValue(x,!0),a.setDisabled(),b.on("focus",function(){a.disabled||(a._blurTimer&&(clearTimeout(a._blurTimer),a._blurTimer=0),m.addClass("picker-focus"),a.showDropList())}).on("blur",function(){a.disabled||(a._blurTimer&&clearTimeout(a._blurTimer),a._blurTimer=setTimeout(function(){a._blurTimer=0,b.is(":focus")||m.removeClass("picker-focus")},100))}).on("input change",function(){if(!a.disabled){var e=b.val();f&&b.width(14*e.length),m.toggleClass("picker-input-empty",!e.length),a.tryUpdateList(e)}}),l.hotkey&&b.on("keydown",function(e){if(!a.disabled){var t=e.key||e.which;if(a.dropListShowed){var i=a.activeValue,o="string"==typeof i;if("Enter"===t||13===t)o&&(a.select(i,f),f?(a.$search.val(""),a.tryUpdateList("")):b.blur(),e.preventDefault(),e.stopPropagation());else if("ArrowDown"===t||40===t){var r,n=a.$activeOption;if(n&&(r=n.next(".picker-option"),f))for(;r.length&&r.hasClass("picker-option-selected");)r=r.next(".picker-option");r&&r.length||(r=a.$optionsList.children(f?".picker-option:not(.picker-option-selected)":".picker-option").first()),r.length&&a.activeOption(r),e.preventDefault(),e.stopPropagation()}else if("ArrowUp"===t||30===t){var s,n=a.$activeOption;if(n&&(s=n.prev(".picker-option"),f))for(;s.length&&s.hasClass("picker-option-selected");)s=s.prev(".picker-option");s&&s.length||(s=a.$optionsList.children(f?".picker-option:not(.picker-option-selected)":".picker-option").last()),s.length&&a.activeOption(s),e.preventDefault(),e.stopPropagation()}else"Escape"===t||27===t?a.hideDropList(!0):l.deleteByBackspace&&f&&("Backspace"===t||8===t)&&a.value&&a.value.length&&!b.val().length&&a.deselect(a.value[a.value.length-1])}}}),f){y.on("mousedown",function(e){if(!a.disabled)return a.dropListShowed&&!l.checkable?(e.preventDefault(),void e.stopPropagation()):void 0}).on("mouseup",function(t){a.disabled||y.hasClass("sortable-sorting")||e(t.target).closest(".picker-selection-remove").length||a.dropListShowed&&!l.checkable||a.focus()});var C=l.sortValuesByDnd;if(C&&e.fn.sortable){m.addClass("picker-sortable");var w={selector:".picker-selection",stopPropagation:!0,start:function(){a.hideDropList(!0)},finish:function(t){var i=[];e.each(t.list,function(e,t){i.push(t.item.data("value"))}),a.setValue(i.slice(),!1,!0)}};"object"==typeof C&&e.extend(w,C),y.sortable(w)}}if(y.on("click",".picker-selection-remove",function(t){if(!a.disabled){if(a.multi){var i=e(this).closest(".picker-selection");a.deselect(i.data("value"))}else a.deselect();t.stopPropagation()}}),d.on("chosen:updated",function(){a.updateFromSelect(!1),a.setValue(d.val(),!0),a.setDisabled(),a.updateList()}).on("chosen:activate",a.focus).on("chosen:open",a.showDropList).on("chosen:close",a.hideDropList),m.addClass("picker-ready"),e.zui.asap(function(){a.triggerEvent("ready",{picker:a},"","chosen:ready")}),!l.disableScrollOnShow){var D=l.hideOnScroll;D&&![t,i,!0].includes(D)&&e(D).on("scroll",this.handleParentScroll.bind(this))}};s.prototype.destroy=function(){var t=this,i=t.options;t.hideDropList(!0);var r=t.$search;r.off("focus blur input change"),i.hotkey&&r.off("keydown"),r.remove();var l=t.$selections;l.off("click"),t.multi&&l.off("mousedown mouseup"),l.remove();var n=t.$formItem;t.selectOptionsBackup&&(n.empty(),e.each(t.selectOptionsBackup,function(t,o){var r={value:o[i.valueKey]},l=o[i.keysKey];void 0!==l&&(r["data-"+i.keysKey]=l),n.append(e("<option />").attr(r).text(o[i.textKey]))})),n.off("chosen:updated chosen:activate chosen:open chosen:close").val(t.value).show(),!t.selfFormItem&&t.$.hasClass("picker")||t.$container.remove(),this.destroyDropList(0),t.$.data(o,null)},s.prototype.focus=function(){this.$search.focus()},s.prototype.select=function(e,t){var i=this;if(i.$search.val()&&i.$search.val(""),!i.isSelectedValue(e)){if(i.triggerEvent("select",{value:e,picker:i})===!1)return;if(i.multi){var o=i.value;o=o?o.slice():[],o.push(e),i.setValue(o)}else i.setValue(e)}t||i.hideDropList()},s.prototype.deselect=function(e){var t=this;if(t.multi){if(!t.isSelectedValue(e))return;if(t.triggerEvent("deselect",{value:e,picker:t})===!1)return;var i=t.value;if(i&&i.length)for(var o=0;o<i.length;++o)if(i[o]===e){i=i.slice(),i.splice(o,1),t.setValue(i);break}}else t.setValue("")},s.prototype.selectAll=function(e){var t=this;if(t.multi&&!t.options.remote){for(var i=[],o=0;o<t.list.length;++o){var r=t.list[o];if(!r.disabled){var l=r[t.options.valueKey];i.push(l)}}t.setValue(i),e||t.hideDropList()}},s.prototype.deselectAll=function(e){var t=this;t.multi&&!t.options.remote&&(t.setValue([]),e||t.hideDropList())},s.prototype.updateMessage=function(e,t,i){var o=this,r=o.$message,l="string"==typeof e&&e.length;e=l?e:"",o.hasMessage=l,r.attr("title",e).text(e).attr("data-type",t),o.$dropMenu.toggleClass("picker-has-message",!!l),i||"top"!==o.dropDirection||o.layoutDropList()},s.prototype.getRemoteList=function(t,i){var o=this,r=o.options.remote;if(r){var l=o.options,n=o.search;if("string"==typeof n&&!n.length&&l.disableEmptySearch)return o.setList([]),void t(!1);var s,a={search:n,limit:l.maxListCount};if(s="string"==typeof r?{url:r}:"function"==typeof r?r(a,o):r,!s.url)return void console.warn("Remote url must provide to get remote list in picker.");var c=!1;s.url.indexOf("{search}")>-1&&(s.url=s.url.replace(/\{search\}/g,n),c=!0),s.url.indexOf("{limit}")>-1&&(s.url=s.url.replace(/\{limit\}/g,l.maxListCount),c=!0),o.updateMessage(""),o.$container.addClass("picker-loading"),o.remoteXhr&&o.remoteXhr.abort(),o.remoteXhr=e.ajax(e.extend({dataType:"json",dataFilter:l.remoteConverter,data:c?null:a},s)).done(function(i,r,n){var s=!1;if(i){if(e.isPlainObject(i))if("success"!==i.result&&"ok"!==i.result||!Array.isArray(i.data))if("fail"===i.result)o.updateMessage(i.message||JSON.stringify(i),"danger");else{var a=[];e.each(i,function(t,i){var o={};o[l.valueKey]=t,"object"==typeof i?e.extend(o,i):o[l.textKey]=i,a.push(o)}),i=a}else i=i.data;Array.isArray(i)&&(s=i.length,o.setList(i,l.remoteOnly))}t&&t(s)}).fail(function(e,t){var r,n=l.onRemoteError;r="function"==typeof n?n(e,t):"string"==typeof n?n:(l.remoteErrorHint||o.lang.remoteErrorHint).format(t||""),o.updateMessage(r,"danger"),i&&i()}).always(function(){o.remoteXhr=null,o.$container.removeClass("picker-loading")})}},s.prototype.layoutDropList=function(i,o,r){var l=this;if(l.$dropMenu){var n,s=l.options,a=s.maxDropHeight||Number.MAX_VALUE,c=l.$dropMenu,p=l.$optionsList;i?n=p.scrollTop():c.css({opacity:0,width:"auto","max-width":"none"}),p.css({"max-height":a}),e.zui.asap(function(){var i=l.$selections[0].getBoundingClientRect(),d=o?s.dropDirection:l.dropDirection||s.dropDirection;"function"==typeof d&&(d=d(i,l));var u=e(t),h=u.height(),v=l.hasMessage?l.$message.outerHeight():0,f=l.showActions?l.$actions.outerHeight():0,g=Math.max(f,v,c.height()),m=s.dropWidth||"auto",y={left:i.left,opacity:1,maxWidth:"initial",minWidth:"initial"};"auto"===d&&(d=i.top+i.height+g>h&&i.top>h-i.top-i.height?"top":"bottom"),l.dropDirection=d;var k=Math.min(a,"bottom"===d?h-i.top-i.height:i.top);if(g=Math.min(g,k),y.top="bottom"===d?i.top+i.height:i.top-g,"100%"===m)y.width=i.width;else if("auto"===m){var b=s.maxAutoDropWidth,S=s.minAutoDropWidth;if(y.width="auto",y.maxWidth="auto"===b?i.width:b,y.minWidth="100%"===S?i.width:S,l.multi){var L=l.$search[0].getBoundingClientRect();y.left=L.left}}else y.width=m;var $=g-v-f;p.css("max-height",$),c.css(y),n&&p.scrollTop(n),r&&r()})}},s.prototype.tryUpdateList=function(e){var t=this;t.search!==e&&(t.search=e,t.updateListTimer&&clearTimeout(t.updateListTimer),t.updateListTimer=setTimeout(function(){t.updateListTimer=null,t.updateList()},t.options.searchDelay))},s.prototype.renderOptionsList=function(t,i){var o=this,r=o.$optionsList;if(void 0===t?t=o.optionsList:o.optionsList=t,r){var l="",n=o.options,s=o.search,a="string"==typeof s&&s.length,c=0;if(t.length){for(var p,d,u,h,v=n.maxListCount,f=n.valueKey,g=n.textKey,m=n.checkable||n.showMultiSelectedOptions,y=v?Math.min(t.length,v):t.length,k=s.toLowerCase(),b=r.children(".picker-option").addClass("picker-expired"),S=o.activeValue,L=void 0!==S&&null!==S,$=0;$<y;++$){var x=t[$],C=x[f],w=o.isSelectedValue(C);if(m||!w||!o.multi){var D=x[g];if(C.length&&(!n.hideEmptyTextOption||D&&D.length)){c++;var _=o.getItemID(x,"option"),O=r.children("#"+_),M=!O.length;M?(O=e('<a class="picker-option" id="'+_+'" data-value="'+C+'"><span class="picker-option-text"></span><span class="picker-option-keys"></span></a>'),n.checkable&&O.prepend('<div class="checkbox-primary"><label></label></div>')):O.removeClass("picker-expired"),O.attr("title",D).removeClass("picker-option-active").toggleClass("disabled",!!x.disabled).toggleClass("picker-option-selected",w),n.checkable&&O.find(".checkbox-primary").toggleClass("checked",w);var T=O.find(".picker-option-text");if(a){var V=D.toLowerCase(),A=V.split(k);if(A.length>1){T.empty();var I=0,E=A[0].length;E&&(T.append(e("<span>").text(D.substr(I,E))),I+=E);for(var K=1;K<A.length;++K)T.append(e('<span class="picker-option-text-matched">').text(D.substr(I,s.length))),I+=s.length,E=A[K].length,E&&(T.append(e("<span>").text(D.substr(I,E))),I+=E)}else T.text(D)}else T.text(D);if(n.optionRender){var R=n.optionRender(O,x,o);R instanceof e&&(O=R)}h?(M||O.prev(".picker-option")[0]!==h[0])&&O.insertAfter(h):M&&O.prependTo(r),h=O,o.multi?w||d||(d=x):!u&&L&&C===S?u=x:w?p=x:d||(d=x)}}}b.filter(".picker-expired").remove(),!i&&y<t.length&&(l=n.accurateSearchHint||o.lang.accurateSearchHint),o.options.checkable||o.activeOption(u||p||d)}else r.empty();c||i||(l=a?(n.emptySearchResultHint||o.lang.emptySearchResultHint).format(s):n.emptyResultHint||o.lang.emptyResultHint,a&&o.triggerEvent("noResults",{search:s,picker:o},"","chosen:no_results"));var H=!1;if(o.multi&&!n.remote){var W=n.multiSelectActions;W&&("number"!=typeof W&&(W=1),t.length>=W&&(H=!0,o.$actions.find('[data-type="select-all"]').attr("disabled",r.children(".picker-option").length?null:"disabled"),o.$actions.find('[data-type="deselect-all"]').attr("disabled",o.value&&o.value.length?null:"disabled")))}o.showActions=H,o.$dropMenu.toggleClass("picker-no-actions",!H),i||o.updateMessage(l,"info"),o.$dropMenu.toggleClass("picker-no-options",!c),o.layoutDropList(o.listRendered),o.listRendered=!0}},s.prototype.activeOption=function(t,i){var o=this;t&&(t instanceof e?t=t.attr("data-value"):"object"==typeof t&&(t=t[o.options.valueKey])),o.$optionsList.find(".picker-option-active").removeClass("picker-option-active");var r=o.getListItem(t);if(r){if(r.disabled)return;o.activeValue=t}else t=o.activeValue;var l=o.$optionsList.find('[data-value="'+t+'"]');if(l.length){if(l.addClass("picker-option-active"),!i){var n=l[0];n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView&&n.scrollIntoView()}o.$activeOption=l}else o.$activeOption=null},s.prototype.updateList=function(e,t,i){var o=this;void 0!==e?o.search=e:e=o.search;var r=o.options.remoteOnly;if(r)o.layoutDropList(!1,!0);else{var l=[];if(null===e||void 0===e||"string"==typeof e&&!e.length)l=o.list||[];else if("function"==typeof o.options.list)l=o.options.list({search:e,limit:o.options.maxListCount});else if(o.list&&o.list.length){var n=o.options.maxListCount,s=o.options.keysKey,a=o.options.textKey,c=o.options.valueKey,p=o.options.searchValueKey,d={};e=e.toLowerCase();for(var u=0;u<o.list.length;++u){var h=o.list[u],v=h[c];if(!o.multi||!o.isSelectedValue(v)){var f=0,g=h[a];if(null!==g&&void 0!==g&&""!==g){g=g.toLowerCase();var m=g.indexOf(e);m>-1&&(f+=0===m?20:10)}if(!f){var y=h[s];if(null!==y&&void 0!==y&&""!==y){y=y.toLowerCase();var m=y.indexOf(e);m>-1&&(f+=0===m?8:4)}}if(!f&&p&&null!==v&&void 0!==v&&""!==v){v=v.toLowerCase();var m=v.indexOf(e);m>-1&&(f+=0===m?3:1)}if(f&&(d[v]=f+(o.list.length-u)/o.list.length,l.push(h)),n&&l.length>=n)break}}l.length&&(l=l.sort(function(e,t){return d[t[c]]-d[e[c]]}))}o.renderOptionsList(l,!1,i)}t||o.getRemoteList(function(t){r?o.renderOptionsList(o.list,!1,i):o.updateList(e,!0)},r?function(){o.renderOptionsList([],!0,i)}:null)},s.prototype.destroyDropList=function(e){var t=this;t._clearTimer&&clearTimeout(t._clearTimer),t.$dropMenu&&(e?t._clearTimer=setTimeout(t.destroyDropList.bind(t,0),e):(t.$optionsList.off("click mouseenter"),t.$optionsList=null,t.$dropMenu.remove(),t.$dropMenu=null,t.$message=null))},s.prototype.showDropList=function(){var t=this,i=t.search,l=t.options;if(("string"!=typeof i||i.length||!l.disableEmptySearch)&&t.triggerEvent("showingDrop",{picker:t})!==!1){if(t._clearTimer&&clearTimeout(t._clearTimer),t.dropListShowed=!0,t.dropDirection=null,t.listRendered=!1,t.activeValue=null,r[t.id]=t,t.options.disableScrollOnShow&&e.zui.fixBodyScrollbar(),!t.$dropMenu){var n=e('<div class="picker-drop-menu" id="pickerDropMenu-'+t.id+'"></div>').attr("data-id",t.id),s=e('<div class="picker-option-list"></div>').appendTo(n),a=t.options.checkable;n.data(o,t).toggleClass("picker-multi",t.multi).toggleClass("picker-single",!t.multi).toggleClass("picker-checkable",!!a).appendTo("body"),t.options.chosenMode&&n.addClass("chosen-up"),s.on("click",".picker-option:not(.disabled)",function(){var i=e(this),o=i.hasClass("picker-option-selected");if(!o||a){var r=i.attr("data-value");o?t.deselect(r):t.select(r,a)}}).on("mouseenter",".picker-option:not(.disabled)",function(){a||t.activeOption(e(this),!0)}),t.multi&&!t.options.remote&&(t.$actions=e(['<div class="picker-actions">','<button type="button" class="btn btn-sm btn-link picker-action" data-type="select-all">'+t.lang.selectAll+"</button>",'<button type="button" class="btn btn-sm btn-link picker-action" data-type="deselect-all">'+t.lang.deselectAll+"</button>","</div>"].join("")).appendTo(n),t.$actions.on("click",".picker-action",function(i){var o=e(this).data("type");"select-all"===o?t.selectAll(a):"deselect-all"===o&&t.deselectAll(a)})),t.$message=e('<div class="picker-message"></div>').appendTo(n),t.$dropMenu=n,t.$optionsList=s}t.updateList(t.search,!1,function(){t.triggerEvent("showedDrop",{picker:t},"","chosen:showing_dropdown")}),t.$dropMenu.addClass("picker-drop-show")}},s.prototype.hideDropList=function(t){var i=this;if(i.triggerEvent("hidingDrop",{picker:i})!==!1){i.dropListShowed=!1,i.$activeOption=null,i.activeValue=null,i.$search.val(""),i.search="",delete r[i.id],i.$dropMenu&&i.$dropMenu.removeClass("picker-drop-show"),i.options.disableScrollOnShow&&e.zui.resetBodyScrollbar(),t&&this.$search.blur(),i.triggerEvent("hiddenDrop",{picker:i},"","chosen:hiding_dropdown");var o=i.options.autoClearDrop;o&&i.destroyDropList(o)}},s.prototype.updateFromSelect=function(t){var i=this,o=i.options,r=[];void 0===t&&(t=!0);var l=i.$formItem.children("option");l.length&&(l.each(function(){var t=e(this),l=t.val(),n=t.text();if(o.onUpdateSelectOption){var s=o.onUpdateSelectOption(t,i);s&&r.push(s)}else if(n.length||l.length){var s={};s[o.valueKey]=l,s[o.textKey]=n,s[o.keysKey]=t.data(o.keysKey),s.disabled=t.attr("disabled"),r.push(s)}var a=o.allowSingleDeselect;"auto"!==a&&null!==a&&void 0!==a||l.length||(o.allowSingleDeselect=!0)}),i.selectOptionsBackup=r.slice()),i.setList(r,t)},s.prototype.setList=function(e,t){var i=this,o=i.options,r=t?[]:i.list||[],l=t?{}:i.listMap||{};"string"==typeof e&&(e=e.split(o.multiValueSplitter));for(var n=0;n<e.length;++n){var s=e[n];if("string"==typeof s){var a={};a[o.textKey]=s,a[o.valueKey]=String(n),s=a}else if(Array.isArray(s)){var a={};a[o.textKey]=s[0],a[o.valueKey]=s[1],a[o.keysKey]=s[2],s=a}var c=s[o.valueKey];"string"!=typeof c&&(c=String(c),s[o.valueKey]=c);var p=l[c];p?(s.index=p.$_index,r[p.$_index]=s,l[c]=s):(s.$_index=r.length,l[c]=s,r.push(s))}i.list=r,i.listMap=l},s.prototype.updateOptionList=function(e,t){var i=this;i.setList(e,t),i.dropListShowed&&i.renderOptionsList()},s.prototype.removeFromList=function(e){var t=this,i=t.list||[];if(i.length){var o=t.options;"string"==typeof e&&(e=e.split(o.multiValueSplitter));for(var r={},l=0;l<e.length;++l){var n=e[l];r["object"==typeof n?n[o.valueKey]:n]=!0}for(var s=[],a={},l=0;l<i.length;++l){var n=i[l],c=n[o.valueKey];r[c]||(s.push(n),a[c]=n)}t.list=s,t.listMap=a,t.setValue(t.multi?t.value.slice():t.value)}},s.prototype.getItemID=function(e,t){var i=this.id+"-item-"+btoa(encodeURIComponent(e[this.options.valueKey])).replace(/\+/g,"_").replace(/=/g,"-");return void 0!==t?i+"-"+t:i},s.prototype.isSelectedValue=function(t){var i=this;if(void 0===i.value||null===i.value)return!1;if("string"!=typeof t&&(t=String(t)),i.multi){if(!i.valueSet)if(void 0!==typeof Set)i.valueSet=new Set(i.value);else{i.valueSet={};for(var o=0;o<i.value.length;++o)i.valueSet[i.value[o]]=!0}return e.isPlainObject(i.valueSet)?!!i.valueSet[t]:i.valueSet.has(t)}return t===i.value},s.prototype.getValue=function(){return this.value},s.prototype.getListItem=function(e){return this.listMap[e]},s.prototype.hasListItem=function(e){return void 0!==this.listMap[e]},s.prototype.triggerEvent=function(e,t,i,o){var r=this;if(Array.isArray(t)||(t=[t]),r.$.trigger(e,t),r.options.chosenMode&&o&&r.$.trigger(o,t),i=i===!0?e:i||"on"+e[0].toUpperCase()+e.substr(1),"function"==typeof r.options[i])return r.options[i].apply(r,t)},s.prototype.setDisabled=function(e){var t=this;void 0===e?e="disabled"===t.$formItem.attr("disabled"):t.$formItem.attr("disabled",e?"disabled":null),t.disabled=e,t.$.toggleClass("disabled",e),t.multi||t.$search.attr("disabled",e?"disabled":null)},s.prototype.setValue=function(t,i,o){var r,l=this,n=l.options,s=l.multi;if(void 0===t&&(t=l.$formItem.val()),null===t&&(t=""),s&&"string"==typeof t?t=t.split(n.multiValueSplitter):s||"string"==typeof t||(t=String(t)),n.valueMustInList&&!n.remoteOnly)if(s&&t){for(var a=[],c=0;c<t.length;++c){var p=t[c];l.hasListItem(p)&&a.push(p)}a.length!==t.length&&(t=a)}else s||l.hasListItem(t)||(t=void 0!==n.defaultValue?n.defaultValue:"");var d=l.value;if(s&&d&&t?d.join(n.multiValueSplitter)!==t.join(n.multiValueSplitter):d!==t){if(!i&&l.triggerEvent("beforeChange",{value:t,oldValue:d,picker:l},!0)===!1)return;l.value=t,r=!0}s&&(l.valueSet=null);var u=l.$formItem;if("select"===l.formType){var h=n.chosenMode;h||u.empty(),s?e.each(t,function(e,t){h&&u.find('option[value="'+t+'"]').length||u.append('<option value="'+t+'">')}):h&&u.find('option[value="'+t+'"]').length||u.append('<option value="'+t+'">')}if(u.val(t),!o){var v=!1,f=n.selectionTextRender||function(e,t,i){e.text(t)};if(s){var g=l.$selections,m=g.children(".picker-selection").addClass("picker-expired");e.each(t,function(t,i){void 0===i||null===i?i="":"string"!=typeof i&&(i=String(i));var o=l.getListItem(i);if(o){v=!0;var r=o[n.textKey],s=l.getItemID(o,"selection"),a=m.filter("#"+s);a.length?a.removeClass("picker-expired"):a=e('<div class="picker-selection" id="'+s+'"><span class="picker-selection-text"></span><span class="picker-selection-remove"></span></div>').data("value",i),f(a.find(".picker-selection-text"),r,o),a.attr("title",r).insertBefore(l.$search)}}),m.filter(".picker-expired").remove()}else{var y=l.getListItem(t);v=!!y,f(l.$singleSelection.find(".picker-selection-text"),v?y[n.textKey]:"",y)}l.$container.toggleClass("picker-no-value",!v).toggleClass("picker-has-value",v)}l.dropListShowed&&l.renderOptionsList(),r&&(i||l.triggerEvent("change",{value:t,oldValue:d,picker:l}),l.$[0]!==u[0]&&u.change()),l.$search.is(":focus")||l.$container.removeClass("picker-focus")},s.prototype.handleParentScroll=function(t,o){var r=this;if(!r.options.disableScrollOnShow&&r.dropListShowed){var l=r.options.hideOnScroll&&(!o||t.target===i);r.scrollEventTimer&&e.zui.clearAsap(r.scrollEventTimer),l&&r.$dropMenu.css("opacity",0),r.scrollEventTimer=e.zui.asap(function(){if(r.scrollEventTimer=null,r.dropListShowed){var e=(t.target===i?i.body:t.target).getBoundingClientRect(),o=r.$selections[0].getBoundingClientRect();o.bottom<e.top||o.top>e.bottom?r.hideDropList(!0):r.layoutDropList(!0,!0)}},l?500:0)}},s.DEFAULTS=l,s.NAME=o,s.SHOWS=r,s.convertChosenOptions=function(t){var i=!1;return e.each({allow_single_deselect:"allowSingleDeselect",inherit_select_classes:"inheritFormItemClasses",max_selected_options:"maxSelectedCount",no_results_text:"emptySearchResultHint",placeholder_text:"placeholder",placeholder_text_multiple:"placeholder",placeholder_text_single:"placeholder",single_backstroke_delete:"deleteByBackspace",display_selected_options:"showMultiSelectedOptions",drop_direction:"dropDirection",drop_width:"dropWidth",max_drop_width:"maxAutoDropWidth",highlight_selected:"autoSelectFirst",sort_value_splitter:"multiValueSplitter"},function(e,o){var r=t[e];void 0!==r&&(t[o]=r,delete t[e],i=!0)}),i&&(t.chosenMode=!0),t},e.fn.picker=function(t,i){return this.each(function(){var r=e(this),l=r.data(o),n="object"==typeof t&&t;l?"string"==typeof t&&l[t](i):((s.enabledChosenMode||n&&n.chosenMode)&&(n=s.convertChosenOptions(e.extend({},r.data(),n))),r.data(o,l=new s(this,n)))})},e.fn.picker.Constructor=s,e.Picker=e.zui.Picker=s,s.enableChosen=function(){s.enabledChosenMode||(e.fn.chosen=function(t,i){return this.each(function(){var r=e(this),l=r.data(o);if(!l){var n=e.extend({},r.data(),"object"==typeof t?t:null);return l=new s(this,s.convertChosenOptions(n)),void r.data(o,l)}"string"==typeof t&&l[t](i)})},e.fn._chosen=e.fn.chosen,s.enabledChosenMode=!0)},e.zui.fixBodyScrollbar&&e.zui({_scrollbarWidth:0,checkBodyScrollbar:function(){if(i.body.clientWidth>=t.innerWidth)return 0;if(!e.zui._scrollbarWidth){var o=i.createElement("div");o.className="modal-scrollbar-measure scrollbar-measure",i.body.appendChild(o),e.zui._scrollbarWidth=o.offsetWidth-o.clientWidth,i.body.removeChild(o)}return e.zui._scrollbarWidth},fixBodyScrollbar:function(){if(e.zui.checkBodyScrollbar()){var t=e("body"),i=parseInt(t.css("padding-right")||0,10);return e.zui._scrollbarWidth&&t.css({paddingRight:i+e.zui._scrollbarWidth,overflowY:"hidden"}),!0}},resetBodyScrollbar:function(){e("body").css({paddingRight:"",overflowY:""})}}),e(function(){e('[data-toggle="picker"]').picker(),e(i).on("mousedown",function(t){var i=e(t.target).closest(".picker,.picker-drop-menu"),o=i.length;e.each(r,function(e,t){o&&(i.is(t.$container)||t.$dropMenu&&i.is(t.$dropMenu))||t.hideDropList()})}),e(t).on("scroll",function(t){e.each(r,function(e,i){i.handleParentScroll(t,!0)})})})}(jQuery,window,document);